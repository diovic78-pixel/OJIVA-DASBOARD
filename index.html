x	<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Panel de Trazabilidad de Descarga de Buques</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
  <style>
    :root {
      --primary: #2355a4;
      --secondary: #3498db;
      --success: #27ae60;
      --danger: #e74c3c;
      --warning: #f39c12;
      --light: #f5f7fa;
      --white: #fff;
      --surface: #f9fbfd;
      --card: #e6eef7;
      --border: #dbe3eb;
      --shadow: 0 2px 8px rgba(0, 0, 0, 0.09);
      --shadow-lg: 0 10px 40px rgba(0, 0, 0, 0.15);
      --radius: 14px;
      --radius-sm: 8px;
      --radius-xs: 6px;
    }
    margin: 0;
    padding: 0;
    box-sizing: border-box;
    body {
      font-family: "Segoe UI", Arial, sans-serif;
      background: linear-gradient(135deg, #667eea 0, #764ba2 100%);
      min-height: 100vh;
      color: #19324c;
      overflow-x: hidden;
    }
    /* El resto de tus estilos aquí */
  </style>

  <!-- Firebase core SDKs para web -->
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>
  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyAHCdzhcrgEhP9nke8cu7yL_aqgfVSzHWo",
      authDomain: "ojiva-gestion-descarga.firebaseapp.com",
      projectId: "ojiva-gestion-descarga",
      storageBucket: "ojiva-gestion-descarga.firebasestorage.app",
      messagingSenderId: "334520690865",
      appId: "1:334520690865:web:63f9658eb3fe3390709a90",
      measurementId: "G-EG030XNJP8"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    let productos = [];
    let paradas = [];
    let camiones = [];
    let correas = [];
    let mecanizados = [];

    let currentUsername = '';
  </script>
</head>
<body>
  <!-- Modal Login -->
  <div class="login-overlay" id="login-overlay" style="display:flex; justify-content:center; align-items:center; position:fixed; inset:0; background:rgba(0,0,0,0.7); z-index:10000;">
    <div class="login-modal" style="background:#fff; padding:2rem; border-radius:14px; text-align:center; max-width:400px; width:90%;">
      <h2>Iniciar Sesión</h2>
      <input type="text" id="username" placeholder="Ingrese su nombre" style="width:100%; padding:0.5rem; margin-bottom:1rem;"/>
      <button onclick="login()" style="padding:0.5rem 1rem; font-weight:bold; cursor:pointer;">Entrar</button>
    </div>
  </div>
  
  <!-- Main Content -->
  <div id="app-content" style="display:none;">
    <!-- Productos manifestados -->
    <section>
      <h3>Productos Manifestados</h3>
      <select id="nuevo-producto-tipo">
        <option value="">Seleccione producto...</option>
        <option value="Maz Americano">Maz Americano</option>
        <option value="Maz Argentino">Maz Argentino</option>
        <option value="Maz Brasileo">Maz Brasileo</option>
        <option value="DNS">DNS</option>
        <!-- El resto de productos -->
      </select>
      <select id="nuevo-producto-bodega">
        <option value="">Seleccione bodega...</option>
        <option value="1">Bodega 1</option>
        <option value="2">Bodega 2</option>
        <!-- El resto de bodegas -->
      </select>
      <button onclick="agregarProducto()">Agregar Producto</button>
      <ul id="lista-productos"></ul>
    </section>

    <!-- Paradas -->
    <section>
      <h3>Registro de Paradas</h3>
      <button onclick="agregarParada()">Agregar Parada</button>
      <ul id="lista-paradas"></ul>
    </section>

    <!-- Camiones -->
    <section>
      <h3>Tracking de Camiones</h3>
      <button onclick="agregarCamion()">Agregar Camión</button>
      <ul id="lista-camiones"></ul>
    </section>
    
    <!-- Agrega sección correas y mecanizados similares -->
  </div>

  <script>
    function login() {
      const input = document.getElementById('username').value.trim();
      if (!input) {
        alert('Por favor ingresa tu nombre');
        return;
      }
      currentUsername = input;
      document.getElementById('login-overlay').style.display = 'none';
      document.getElementById('app-content').style.display = 'block';
      cargarProductosDesdeFirebase();
      cargarParadasDesdeFirebase();
      cargarCamionesDesdeFirebase();
      // Carga correas, mecanizados...
    }

    // Funciones productos
    function agregarProducto() {
      const tipo = document.getElementById('nuevo-producto-tipo').value;
      const bodega = document.getElementById('nuevo-producto-bodega').value;
      if (!tipo || !bodega) {
        alert('Debe seleccionar producto y bodega');
        return;
      }
      db.collection('productos').add({
        tipo, bodega, declarado: 0, descargado: 0,
        usuario: currentUsername,
        creadoEn: firebase.firestore.FieldValue.serverTimestamp()
      }).then(() => alert('Producto guardado!'));
    }

    function cargarProductosDesdeFirebase() {
      db.collection('productos')
        .orderBy('creadoEn', 'desc')
        .onSnapshot(snapshot => {
          productos = [];
          snapshot.forEach(doc => productos.push({...doc.data(), id: doc.id}));
          renderProductos();
        });
    }

    function renderProductos() {
      const ul = document.getElementById('lista-productos');
      ul.innerHTML = '';
      productos.forEach(p => {
        const li = document.createElement('li');
        li.textContent = `${p.tipo} - ${p.bodega} (Declarado: ${p.declarado}, Descargado: ${p.descargado})`;
        ul.appendChild(li);
      });
    }

    // Funciones paradas
    function agregarParada() {
      db.collection('paradas').add({
        usuario: currentUsername,
        creadoEn: firebase.firestore.FieldValue.serverTimestamp()
      }).then(() => alert('Parada registrada!'));
    }

    function cargarParadasDesdeFirebase() {
      db.collection('paradas')
        .orderBy('creadoEn', 'desc')
        .onSnapshot(snapshot => {
          paradas = [];
          snapshot.forEach(doc => paradas.push({...doc.data(), id: doc.id}));
          renderParadas();
        });
    }

    function renderParadas() {
      const ul = document.getElementById('lista-paradas');
      ul.innerHTML = '';
      paradas.forEach(p => {
        const li = document.createElement('li');
        li.textContent = `Parada: ${p.usuario} - ${p.creadoEn?.toDate()}`;
        ul.appendChild(li);
      });
    }

    // Funciones camiones (similar)
    function agregarCamion() {
      db.collection('camiones').add({
        usuario: currentUsername,
        creadoEn: firebase.firestore.FieldValue.serverTimestamp()
      }).then(() => alert('Camión registrado!'));
    }

    function cargarCamionesDesdeFirebase() {
      db.collection('camiones')
        .orderBy('creadoEn', 'desc')
        .onSnapshot(snapshot => {
          camiones = [];
          snapshot.forEach(doc => camiones.push({...doc.data(), id: doc.id}));
          renderCamiones();
        });
    }

    function renderCamiones() {
      const ul = document.getElementById('lista-camiones');
      ul.innerHTML = '';
      camiones.forEach(c => {
        const li = document.createElement('li');
        li.textContent = `Camión: ${c.usuario} - ${c.creadoEn?.toDate()}`;
        ul.appendChild(li);
      });
    }

  </script>
<!-- Botón para exportar a Excel -->
<button id="btnExportExcel">Exportar a Excel</button>

<script>
  // Función para exportar datos a Excel usando SheetJS
  function exportToExcel() {
    let wb = XLSX.utils.book_new();
    
    // Exportar productos
    let wsProductos = XLSX.utils.json_to_sheet(productos.map(p => ({
      tipo: p.tipo,
      bodega: p.bodega,
      declarado: p.declarado,
      descargado: p.descargado,
      usuario: p.usuario,
      creadoEn: p.creadoEn ? new Date(p.creadoEn.seconds * 1000).toLocaleString() : ''
    })));
    XLSX.utils.book_append_sheet(wb, wsProductos, "Productos");

    // Exportar paradas
    let wsParadas = XLSX.utils.json_to_sheet(paradas.map(p => ({
      usuario: p.usuario,
      creadoEn: p.creadoEn ? new Date(p.creadoEn.seconds * 1000).toLocaleString() : ''
    })));
    XLSX.utils.book_append_sheet(wb, wsParadas, "Paradas");

    // Exportar camiones
    let wsCamiones = XLSX.utils.json_to_sheet(camiones.map(c => ({
      usuario: c.usuario,
      creadoEn: c.creadoEn ? new Date(c.creadoEn.seconds * 1000).toLocaleString() : ''
    })));
    XLSX.utils.book_append_sheet(wb, wsCamiones, "Camiones");

    // Exportar incidentes
    let wsIncidentes = XLSX.utils.json_to_sheet(incidentes.map(i => ({
      descripcion: i.descripcion,
      usuario: i.usuario,
      creadoEn: i.creadoEn ? new Date(i.creadoEn.seconds * 1000).toLocaleString() : ''
    })));
    XLSX.utils.book_append_sheet(wb, wsIncidentes, "Incidentes");

    XLSX.writeFile(wb, "gestion_descarga.xlsx");
  }

  document.getElementById("btnExportExcel").addEventListener("click", exportToExcel);
</script>
<!-- Contenedor Dashboard -->
<div id="dashboard">
  <h2>Dashboard</h2>
  <canvas id="graficoProductos" width="400" height="200"></canvas>
  <canvas id="graficoParadas" width="400" height="200"></canvas>
  <!-- Más gráficos según necesites -->
</div>

<!-- Incluye Chart.js para gráficas -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
  let chartProductos, chartParadas;

  function crearGraficoProductos() {
    const ctx = document.getElementById('graficoProductos').getContext('2d');
    const tipos = [...new Set(productos.map(p => p.tipo))];
    const cantidades = tipos.map(tipo => 
      productos.filter(p => p.tipo === tipo).reduce((sum, p) => sum + (p.declarado || 0), 0)
    );
    if(chartProductos) chartProductos.destroy();

    chartProductos = new Chart(ctx, {
      type: 'bar',
      data: {
        labels: tipos,
        datasets: [{
          label: 'Productos Declarados',
          data: cantidades,
          backgroundColor: '#2355a4'
        }]
      },
      options: {}
    });
  }

  function crearGraficoParadas() {
    const ctx2 = document.getElementById('graficoParadas').getContext('2d');
    const usuarios = [...new Set(paradas.map(p => p.usuario))];
    const cantidades = usuarios.map(usuario =>
      paradas.filter(p => p.usuario === usuario).length
    );
    if(chartParadas) chartParadas.destroy();

    chartParadas = new Chart(ctx2, {
      type: 'pie',
      data: {
        labels: usuarios,
        datasets: [{
          label: 'Paradas por usuario',
          data: cantidades,
          backgroundColor: ['#2355a4', '#3498db', '#27ae60', '#e74c3c', '#f39c12']
        }]
      },
      options: {}
    });
  }

  // Actualizar gráficos al cargar datos
  function actualizarGraficos() {
    crearGraficoProductos();
    crearGraficoParadas();
    // Más gráficos...
  }

  // Llamar actualización cuando se cargan datos
  function renderProductos() {
    const ul = document.getElementById('lista-productos');
    ul.innerHTML = '';
    productos.forEach(p => {
      const li = document.createElement('li');
      li.textContent = `${p.tipo} - ${p.bodega} (Declarado: ${p.declarado}, Descargado: ${p.descargado})`;
      ul.appendChild(li);
    });
    actualizarGraficos();
  }

  function renderParadas() {
    const ul = document.getElementById('lista-paradas');
    ul.innerHTML = '';
    paradas.forEach(p => {
      const li = document.createElement('li');
      li.textContent = `Parada: ${p.usuario} - ${p.creadoEn?.toDate()}`;
      ul.appendChild(li);
    });
    actualizarGraficos();
  }

</script>
</body>
</html>
